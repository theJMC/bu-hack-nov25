<!DOCTYPE html>
<html>
    <head>
        <title>Controller</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    </head>
    <body>
        <div class="container">
            <h1>Game Controller</h1>
            <h2>Game ID: <span id="game-id"></span></h2>
            <h2>Player: <span id="player-number"></span></h2>
            <button class="btn btn-primary" onclick="sendEvent('jump')">JUMP</button>
            <button class="btn btn-primary" onclick="sendEvent('slide')">SLIDE</button>
            <button class="btn btn-primary" onclick="sendEvent('shake')">SHAKE</button>
        </div>

        <ul id='messages'>
        </ul>
        <script>
            var game_id = localStorage.getItem('gameId');
            document.getElementById('game-id').innerText = game_id;
            var ws = new WebSocket(`wss://${window.location.hostname}/ws/${game_id}/player`);
            ws.onmessage = function(event) {
                const msg = JSON.parse(event.data);
                switch (msg["code"]) {
                    case 201:
                        document.getElementById('player-number').innerText = msg["playerNum"]
                        document.body.style.backgroundColor = msg["colour"]
                        break;
                    default:
                        var messages = document.getElementById('messages')
                        var message = document.createElement('li')
                        var content = document.createTextNode(`${msg.code}-${msg.content}`)
                        message.appendChild(content)
                        messages.appendChild(message)
                }
            };
            
            function sendEvent(event) {
                ws.send(JSON.stringify({"code": 200, "content": event}))
                event.preventDefault()
            }
        </script>
    </body>
</html>