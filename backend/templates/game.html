<!DOCTYPE html>
<html>
    <head>
        <title>Controller</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    </head>
    <body>
        <div class="container">
            <h1>Game Controller</h1>
            <h2>Game ID: <span id="game-id"></span></h2>
            <h2>Player: <span id="player-number"></span></h2>
            <div class="d-grid gap-2" id="controls">
                <button class="btn btn-primary" onclick="sendEvent('jump')">JUMP</button>
                <button class="btn btn-primary" onclick="sendEvent('slide')">SLIDE</button>
                <button class="btn btn-primary" onclick="sendEvent('shake')">SHAKE</button>
            </div>
            <br>
            <br>
            <div class="alert alert-danger" role="alert" id="errMsgBox" hidden>

            </div>
            <ul id='messages'>
            </ul>
        </div>

        <script>
            var game_id = localStorage.getItem('gameId');
            document.getElementById('game-id').innerText = game_id;
            var ws = new WebSocket(`wss://${window.location.hostname}/ws/${game_id}/player`);
            ws.onmessage = function(event) {
                var newMsg = (msgContent) => {
                        var messages = document.getElementById('messages')
                        var message = document.createElement('li')
                        var content = document.createTextNode(msgContent)
                        message.appendChild(content)
                        messages.appendChild(message)
                    }
                var errorMsg = (msgContent) => {
                    var msgBox = document.getElementById('errMsgBox')
                    var controlsDiv = document.getElementById('controls')
                    msgBox.appendChild(document.createTextNode(msgContent))
                    msgBox.hidden = false
                    controlsDiv.style.display = 'none';
                }
                const msg = JSON.parse(event.data);
                switch (msg["code"]) {

                    case 201:
                        document.getElementById('player-number').innerText = msg["playerNum"]
                        document.body.style.backgroundColor = msg["colour"]
                        break;
                    case 202:
                        newMsg(`${msg.code}-${msg.action}-${msg.intensity}`)
                        break;
                    case 400 | 404:
                        errorMsg(msg["content"])
                        break;
                    default:
                        newMsg(msg["content"])
                }
            };
            
            function sendEvent(event) {
                var send = {"code": 202, "action": event, "intensity": 1, "timestamp": Date.now()}
                ws.send(send)
            }
        </script>
    </body>
</html>