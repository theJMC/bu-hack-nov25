<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  </head>
  <body>
    <div class="container">
        <h1>New Game</h1>
        <button class="btn btn-success" onclick="newGame()">New Game</button>
        <h2>Game List</h2>
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">Game ID</th>
                    <th scope="col"></th>
                    <th scope="col"></th>
                </tr>
            </thead>
            <tbody id="game-list-body">
                <tr>
                    <th>{ID}</th>
                    <td><button class="btn btn-primary">Join</button></td>
                    <td><button class="btn btn-danger">Delete</button></td>
                </tr>
            </tbody>
        </table>
        <ul id="game-list"></ul>
        <button class="btn btn-secondary" onclick="refreshGames()">Refresh</button>
        <hr>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  <script>
      window.onload = () => {
          refreshGames();
      }
      function newGame() {
          var req = new XMLHttpRequest();
          req.open("GET", "/game/new", true);
          req.send();
          req.onreadystatechange = function() {
              if (req.readyState == 4 && req.status == 200) {
                  refreshGames();
              }
          }
      }
      function refreshGames() {
          var newGameRow = (gameID) => {
            var tableRow = document.createElement("tr");

            var idCell = document.createElement("th");
            var idCellText = document.createTextNode(gameID);
            idCell.appendChild(idCellText);

            var joinCell = document.createElement("td");
            var joinPlayerCellButton = document.createElement("button");
            joinPlayerCellButton.className = "btn btn-primary";
            joinPlayerCellButton.innerText = "Join: Player";
            joinPlayerCellButton.onclick = () => {
                localStorage.setItem("gameId", gameID);
                window.location.href = "/chat";
            }
            joinCell.appendChild(joinPlayerCellButton);

            var joinHostCellButton = document.createElement("button");
            joinHostCellButton.className = "btn btn-primary";
            joinHostCellButton.innerText = "Join: Host";
            joinHostCellButton.onclick = () => {
                localStorage.setItem("gameId", gameID);
                window.location.href = "/host";
            }
            joinCell.appendChild(joinHostCellButton);

            var deleteCell = document.createElement("td");
            var deleteCellButton = document.createElement("button");
            deleteCellButton.className = "btn btn-danger";
            deleteCellButton.innerText = "Delete";
            deleteCellButton.onclick = () => {
                var req = new XMLHttpRequest();
                req.open("DELETE", "/game/" + gameID, true);
                req.send();
                req.onreadystatechange = function() {
                    if (req.readyState == 4 && req.status == 200) {
                        console.log(req.responseText);
                        refreshGames();
                    }
                }
            }
            deleteCell.appendChild(deleteCellButton);

            tableRow.appendChild(idCell);
            tableRow.appendChild(joinCell);
            tableRow.appendChild(deleteCell);
            document.getElementById("game-list-body").appendChild(tableRow);

          }
          var req = new XMLHttpRequest();
          req.open("GET", "/game", true);
          req.send();
          req.onreadystatechange = function() {
              if (req.readyState == 4 && req.status == 200) {
                  var games = JSON.parse(req.responseText);
                  var tableBody = document.getElementById("game-list-body");
                  tableBody.innerHTML = "";
                  for (var i = 0; i < games.length; i++) {
                      newGameRow(games[i]["game_id"]);
                  }
              }
          }
      }
  </script>
  </body>
</html>